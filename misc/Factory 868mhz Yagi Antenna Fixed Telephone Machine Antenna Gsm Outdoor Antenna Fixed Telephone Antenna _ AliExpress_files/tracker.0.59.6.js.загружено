!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).tracker={})}(this,(function(e){"use strict";function t(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(e);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(e,i[o])&&(n[i[o]]=e[i[o]])}return n}function n(e,t,n,i){return new(n||(n=Promise))((function(o,r){function a(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((i=i.apply(e,t||[])).next())}))}var i,o,r,a,s;!function(e){e.INVOKE_FROM_NATIVE="INVOKE_FROM_NATIVE"}(i||(i={})),function(e){e.PING="PING",e.LOGIN="LOGIN",e.SHARE="SHARE",e.SET_TOOLBAR_CONFIG="SET_TOOLBAR_CONFIG",e.JWT_AUTH="JWT_AUTH",e.GEOLOCATION="GEOLOCATION",e.CLIPBOARD_COPY="CLIPBOARD_COPY",e.CALL_PHONE="CALL_PHONE",e.TOKEN_PAY_CHECK="TOKEN_PAY_CHECK",e.TOKEN_PAY="TOKEN_PAY",e.APP_INFO="APP_INFO",e.OPEN_URL="OPEN_URL",e.DISMISS="DISMISS",e.SELECT_PICK_UP_POINT="SELECT_PICK_UP_POINT",e.UPDATE_PASSPORT_DATA="UPDATE_PASSPORT_DATA",e.SET_PROGRESS_VISIBILITY="SET_PROGRESS_VISIBILITY",e.UT_TRACK_EVENT="UT_TRACK_EVENT",e.SET_PAGE_VIEW_EVENT_PARAMETERS="SET_PAGE_VIEW_EVENT_PARAMETERS",e.SEND_MIXER_EVENT="SEND_MIXER_EVENT",e.ON_BACK_PRESSED="ON_BACK_PRESSED",e.GET_APP_LOCAL_ANALYTICS_STATE="GET_APP_LOCAL_ANALYTICS_STATE",e.LOCAL_ANALYTICS_WEB_PAGE_VIEW="LOCAL_ANALYTICS_WEB_PAGE_VIEW",e.SESSION_VERIFY="SESSION_VERIFY"}(o||(o={})),function(e){e.ON_OPTIONS_MENU_CLICK="ON_OPTIONS_MENU_CLICK"}(r||(r={})),function(e){e.NATIVE="native",e.WEBVIEW="webview"}(a||(a={})),function(e){e.NOT_IN_BROWSER="NOT_IN_BROWSER",e.EVENT_JSON_STRINGIFY_FAILURE="EVENT_JSON_STRINGIFY_FAILURE",e.EVENT_JSON_PARSE_FAILURE="EVENT_JSON_PARSE_FAILURE",e.EVENT_CANCELLED="EVENT_CANCELLED",e.EVENT_TIMEOUT_EXCEEDED="EVENT_TIMEOUT_EXCEEDED",e.FAILED_TO_SEND="FAILED_TO_SEND",e.EVENT_PROCESSING_FAILURE="EVENT_PROCESSING_FAILURE",e.BRIDGE_IS_NOT_AVAILABLE="BRIDGE_IS_NOT_AVAILABLE",e.EXCEED_EVENT_MAX_LIMIT="EXCEED_EVENT_MAX_LIMIT",e.UNKNOWN_EVENT_TYPE="UNKNOWN_EVENT_TYPE",e.EVENT_INVALID_PAYLOAD="EVENT_INVALID_PAYLOAD"}(s||(s={}));const l="undefined"!=typeof window,d={[o.PING]:!0,[o.GET_APP_LOCAL_ANALYTICS_STATE]:!0},c=new class{constructor(){this.logLevel="NONE",this.maxEventSize=50,this.initTimeout=100,this.mode="STRICT",this.useNativeDeclaration=!0,this.canPassWithoutBridgeBeingReady=e=>d[e]}setUseNativeDeclaration(e){this.useNativeDeclaration=e}setLogLevel(e){this.logLevel=e}setInitTimeout(e){this.initTimeout=e}setMode(e){this.mode=e}setMaxEventSize(e){this.maxEventSize=e}getMaxEventSize(){return this.maxEventSize}};class u extends Error{constructor(e,t){super(e),this.timestamp=Date.now(),this.code=t,this.message=e,"ERROR"!==c.logLevel&&"DEBUG"!==c.logLevel||console.error(this)}toJSON(){return this.valueOf()}toString(){return JSON.stringify(this.valueOf())}valueOf(){return{code:this.code,message:this.message,stack:this.stack,timestamp:this.timestamp}}}var v;!function(e){e.ANDROID="android",e.IOS="ios",e.UNKNOWN="N/A"}(v||(v={}));const p=e=>{var t;const n=/([a-z0-9.]+)/gi,i=Object.create(null),o=["vendor","platform","platformVersion","versionCode","versionNumber"];for(const r of o){const o=(null===(t=n.exec(e))||void 0===t?void 0:t[1])||"";switch(r){case"platform":/ios/.test(o)?i.platform=v.IOS:/android/.test(o)?i.platform=v.ANDROID:i.platform=v.UNKNOWN;break;case"versionCode":case"platformVersion":Object.assign(i,{[r]:Number(o||v.UNKNOWN)});break;default:Object.assign(i,{[r]:o||v.UNKNOWN})}}return i.featureFlags=Object.setPrototypeOf([],null),Object.freeze(i.featureFlags),Object.freeze(i)},g=l?p(window.navigator.userAgent):{featureFlags:[],platform:v.UNKNOWN,platformVersion:v.UNKNOWN,vendor:v.UNKNOWN,versionCode:v.UNKNOWN,versionNumber:v.UNKNOWN},_=v,h=()=>l&&window.AerWebView,f=e=>{try{g.platform===_.IOS&&window.webkit.messageHandlers.AerWebViewBridge.postMessage(e),g.platform===_.ANDROID&&window.AerWebViewBridge.postMessage(e)}catch(e){console.error(e)}};class w{constructor(){if(this.eventsMap=new Map,this.eventsBeforeInitQueue=[],this.isReady=!1,this.isReadinessChecked=!1,c.useNativeDeclaration&&h())return h();this.incomingEventListener=this.incomingEventListener.bind(this),l&&window.addEventListener("message",this.incomingEventListener)}setIsReady(e){this.isReady=e,this.isReadinessChecked=!0}static createRejectableFn(e,t){return n=>{n?e():t()}}flush(){this.eventsBeforeInitQueue.forEach((e=>{e(this.isReady)}))}checkIfSizeNotOverlapping(){return this.eventsMap.size>=c.maxEventSize}call(e){return"DEBUG"===c.logLevel&&console.log(e),new Promise((t=>{if(this.checkIfSizeNotOverlapping())t({data:null,error:new u(String(this.eventsMap.size),s.EXCEED_EVENT_MAX_LIMIT)});else if(l){this.eventsMap.set(e.tag,t);try{if(this.isReady||c.canPassWithoutBridgeBeingReady(e.type)||"LOOSE"===c.mode)f(w.toJSON(e));else{const n=()=>f(w.toJSON(e)),i=()=>{this.eventsMap.delete(e.tag),t({data:null,error:new u("failed to open bridge",s.BRIDGE_IS_NOT_AVAILABLE)})};if(this.isReadinessChecked&&!this.isReady&&"STRICT"===c.mode)return void i();this.eventsBeforeInitQueue.push(w.createRejectableFn(n,i))}}catch(n){this.eventsMap.delete(e.tag),t({data:null,error:new u((null==n?void 0:n.message)||"unknown",s.FAILED_TO_SEND)})}}else t({data:null,error:new u("",s.NOT_IN_BROWSER)})}))}incomingEventListener(e){var t,n;let i;try{i=w.fromJSON(e.data)}catch(e){return void("DEBUG"===c.logLevel&&console.error(e))}if(w.shouldProcessEvent(i)&&("DEBUG"===c.logLevel&&console.log(i),i.source===a.NATIVE&&this.eventsMap.has(i.tag))){const e=this.eventsMap.get(i.tag);this.eventsMap.delete(i.tag),e({data:null===(t=i.payload)||void 0===t?void 0:t.data,error:w.processErrorCases(null===(n=i.payload)||void 0===n?void 0:n.error)})}}static toJSON(e){try{return JSON.stringify(e)}catch(e){throw new u((null==e?void 0:e.message)||"unknown",s.EVENT_JSON_STRINGIFY_FAILURE)}}static fromJSON(e){try{return JSON.parse(e)}catch(e){throw new u((null==e?void 0:e.message)||"unknown",s.EVENT_JSON_PARSE_FAILURE)}}static shouldProcessEvent(e){return(null==e?void 0:e.source)===a.NATIVE}cancel(e,t){if(!this.eventsMap.has(e))return!1;const n=this.eventsMap.get(e);return this.eventsMap.delete(e),n({data:null,error:new u("cancelled",t||s.EVENT_CANCELLED)}),!0}static processErrorCases(e){if(!e)return null;switch(e){case s.UNKNOWN_EVENT_TYPE:return new u("the unrecognized event type",s.UNKNOWN_EVENT_TYPE);case s.EVENT_INVALID_PAYLOAD:return new u("invalid payload",s.EVENT_INVALID_PAYLOAD);default:return new u(e,s.EVENT_PROCESSING_FAILURE)}}}const m=new w,E=()=>"undefined"!=typeof window&&void 0!==(null===window||void 0===window?void 0:window.crypto.getRandomValues)?window.crypto.getRandomValues(new Uint32Array(1))[0]:Number(String(Math.random()).split(".")[1]);function y(e){return t=>{const n={tag:E(),payload:t,source:a.WEBVIEW,type:e,origin:t.origin||"*"};return m.call(n)}}new class{constructor(){this.listenersMap=new Map,this.listenNativeMessages=this.listenNativeMessages.bind(this),l&&window.addEventListener("message",this.listenNativeMessages)}listen(e,t){var n;const i=E();if(this.listenersMap.has(e))null===(n=this.listenersMap.get(e))||void 0===n||n.set(i,t);else{const n=new Map;this.listenersMap.set(e,n),n.set(i,t)}return i}unListen(e,t){var n;this.listenersMap.has(e)&&(null===(n=this.listenersMap.get(e))||void 0===n||n.delete(t))}invoke(e){const{type:t,payload:n}=e;if(t!==i.INVOKE_FROM_NATIVE)return;if(!this.listenersMap.has(n.listenerType))return;const o=this.listenersMap.get(n.listenerType);if(o)for(const e of Array.from(o.values()))e({data:n.data,error:n.error})}listenNativeMessages(e){let t;try{t=w.fromJSON(e.data)}catch(e){return}w.shouldProcessEvent(t)&&this.invoke({payload:t.payload,type:t.type})}};let I=3;const O=()=>{const e="DEBUG"===c.logLevel;if(m.isReady)return void(e&&console.log("init: already ready"));e&&console.log("init: start");const[t]=((e,t,n=1e6)=>{const i=E(),o=()=>m.cancel(i,s.EVENT_TIMEOUT_EXCEEDED),r=setTimeout((()=>{1e6!==n&&o()}),n);return[new Promise((n=>{m.call({type:e,tag:i,payload:t,source:a.WEBVIEW}).then((e=>{clearTimeout(r),n(e)}))})),o]})(o.PING,{},c.initTimeout);t.then((t=>{var n;const i=!!(null===(n=null==t?void 0:t.data)||void 0===n?void 0:n.success);if(!i&&I>0)return I--,O(),void(e&&console.log("init: retrying %s",3-I));m.setIsReady(i),m.flush(),e&&console.log("init: got result",JSON.stringify(t))}))},N=y(o.PING),T=y(o.LOGIN),b=y(o.SHARE),P=y(o.SET_PROGRESS_VISIBILITY),A=y(o.SET_TOOLBAR_CONFIG),L=y(o.JWT_AUTH),S=y(o.GEOLOCATION),C=y(o.CLIPBOARD_COPY),R=y(o.CALL_PHONE),D=y(o.TOKEN_PAY_CHECK),k=y(o.TOKEN_PAY),V=y(o.APP_INFO),j=y(o.OPEN_URL),U=y(o.DISMISS),x=y(o.SEND_MIXER_EVENT),M=y(o.SELECT_PICK_UP_POINT),B=y(o.UPDATE_PASSPORT_DATA),W=y(o.UT_TRACK_EVENT),F=y(o.SET_PAGE_VIEW_EVENT_PARAMETERS),G=y(o.ON_BACK_PRESSED),z=y(o.GET_APP_LOCAL_ANALYTICS_STATE),K=y(o.LOCAL_ANALYTICS_WEB_PAGE_VIEW),Y=y(o.SESSION_VERIFY);var J=Object.freeze({__proto__:null,ping:N,login:T,share:b,setProgressVisibility:P,setToolbarConfig:A,getJwtAuthToken:L,geolocation:S,copy:C,phoneCall:R,checkTokenPay:D,tokenPay:k,appInfo:V,openUrl:j,dismiss:U,sendMixer:x,selectPickUpPoint:M,updatePassportData:B,sendUtTrack:W,setPVParams:F,onBackPressed:G,getAppLocalAnalyticsState:z,saveTrackerData:K,sendSessionVerifyResult:Y});const $="a_t_info",H="a_r_t_info",X="spm",Q="aer_console_host",q="aer_tracker_page_click_ids",Z="aerConsoleButtonId",ee="Network initialize error",te="product",ne="page",ie="page_view";const oe=new class{constructor(){this.internalIsWebView=!1,this.internalIsGCP=!1,this.internalPageData={},this.internalExcludeFieldsConfig=null,this.internalPlatform="empty",this.internalIsIosWv=!1,this.internalAerConsoleUrl="",this.internalTrackerLogData={},this.internalIsInitialized=!1}set pageData(e){this.internalPageData=e}get pageData(){return this.internalPageData}set excludeFieldsConfig(e){this.internalExcludeFieldsConfig=e}get excludeFieldsConfig(){return this.internalExcludeFieldsConfig}set isWebView(e){this.internalIsWebView=e}get isWebView(){return this.internalIsWebView}set isGCP(e){this.internalIsGCP=e}get isGCP(){return this.internalIsGCP}set platform(e){this.internalPlatform=e}get platform(){return this.internalIsWebView?"webview":this.internalPlatform}set isIosWv(e){this.internalIsIosWv=e}get isIosWv(){return this.internalIsIosWv}get aerConsoleUrl(){return this.internalAerConsoleUrl}set aerConsoleUrl(e){this.internalAerConsoleUrl=e}set trackerLogData(e){this.internalTrackerLogData=Object.assign({},e)}get trackerLogData(){return this.internalTrackerLogData}set isInitialized(e){this.internalIsInitialized=e}get isInitialized(){return this.internalIsInitialized}},re=e=>{var t,n,i;const o=null===(i=null===(n=null===(t=null===document||void 0===document?void 0:document.cookie)||void 0===t?void 0:t.split("; "))||void 0===n?void 0:n.map((e=>e.replace("=",":=").split(":="))))||void 0===i?void 0:i.reduce(((e,[t,n])=>Object.assign(Object.assign({},e),{[decodeURIComponent(t)]:decodeURIComponent(n)})),{});return null==o?void 0:o[e]},ae=(e,t)=>{document.cookie=`${e}=${t}; SameSite=None; Secure; domain=.aliexpress.ru; path=/`},se=()=>{if("undefined"!=typeof window)return window.location||void 0},le=({userParams:e})=>{var t,n,i,o,r;return{retryCount:0,domainName:(null===(t=null==e?void 0:e.rp)||void 0===t?void 0:t.domain)||"",chinaDeviceId:(null===(n=null==e?void 0:e.rp)||void 0===n?void 0:n["cookie:cna"])||(null===(i=null===window||void 0===window?void 0:window.goldlog)||void 0===i?void 0:i.Etag)||"",deviceId:e.abid||"",googleId:re("_ga")||"",namespace:(null==e?void 0:e.namespace)||"external",platform:(null===(o=null==e?void 0:e.rp)||void 0===o?void 0:o.platform)||"",screenResolutionX:null===window||void 0===window?void 0:window.screen.width,screenResolutionY:null===window||void 0===window?void 0:window.screen.height,appsflyerId:"",isIframe:(null===window||void 0===window?void 0:window.self)!==(null===window||void 0===window?void 0:window.top)||!1,randomToken:(null===(r=null==e?void 0:e.rp)||void 0===r?void 0:r.foreverRandomToken)||void 0}},de=({userParams:e})=>{var t,n;if(!oe.isGCP)return{};return{chinaDeviceId:re("cna")||"",platform:oe.platform||(()=>{if("undefined"!=typeof window)return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?"msite":"pc"})(),domainName:(null===(t=null==e?void 0:e.rp)||void 0===t?void 0:t.domain)||(null===(n=se())||void 0===n?void 0:n.host)}};function ce(){return new Promise(((e,t)=>{const n=document.body.getAttribute("data-spm")||null;n?e(n):t(n)}))}const ue=(e,t,n)=>new Promise(((i,o)=>e().then(i).catch((r=>{return n>0?(a=t,new Promise((e=>setTimeout(e,a)))).then(ue.bind(null,e,2*t,n-1)).then(i).catch(o):o(r);var a})))),ve=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),pe=e=>{try{if(!e)throw Error;const{origin:t,pathname:n}=new URL(e);return new URL(n,t).toString()}catch(e){return""}},ge=({userParams:e,trackerLogData:t})=>{var n,i,o,r,a,s,l,d;const[c,u]=(null===(o=null===(i=null===(n=null==e?void 0:e.rp)||void 0===n?void 0:n["request.Path"])||void 0===i?void 0:i.split("/"))||void 0===o?void 0:o.filter((e=>e)))||[],v="item"===c?null===(r=u.split("."))||void 0===r?void 0:r[0]:void 0,p=(null===document||void 0===document?void 0:document.referrer)||t.referralUrl||void 0,g=(null==e?void 0:e.alias)||"",_=(null==e?void 0:e.smpB)||"",h=t.prevPageName||"",f=pe(null===(a=null==e?void 0:e.rp)||void 0===a?void 0:a["request.URL"]),w=pe(p),m=(null===(s=null==e?void 0:e.layout)||void 0===s?void 0:s.id)||0,E=(null===(l=null==e?void 0:e.layout)||void 0===l?void 0:l.name)||"",y=t.currentId||"",I=t.prevPageId||"",O=t.prevChinaName||"",N=(null==e?void 0:e.traceId)||void 0,T=(null===window||void 0===window?void 0:window.dmtrack_pageid)||"",b=!v||+v?v:null===(d=v.split("_"))||void 0===d?void 0:d[1],P=(null==e?void 0:e.eagleeyeTraceId)||"",A=(null==e?void 0:e.time)||"";return Object.assign(Object.assign(Object.assign({},null==e?void 0:e.analyticsPageData),{name:g,chinaName:_,previousName:h,currentUrl:f,referralUrl:w,layoutId:m,layoutName:E,pageViewId:y,previousPageViewId:I,previousChinaName:O,traceId:N,utPageId:T,eagleeyeTraceId:P,time:A}),b&&{itemId:b})},_e=({trackerLogData:e,userParams:t})=>n(void 0,void 0,void 0,(function*(){var i,o;if(!oe.isGCP)return{};const{page:r}=e,a=(()=>{var e,t,n;if(void 0!==window){const[,i]=(null===(n=null===(t=new URLSearchParams(null===(e=null===window||void 0===window?void 0:window.location)||void 0===e?void 0:e.search))||void 0===t?void 0:t.get("spm"))||void 0===n?void 0:n.split("."))||[];return i}})(),s=yield n(void 0,void 0,void 0,(function*(){try{return ue(ce,1e3,10)}catch(e){return"time_out_initialize_gcp"}}));return{previousChinaName:a,utPageId:(null===window||void 0===window?void 0:window.dmtrack_pageid)||(null==r?void 0:r.utPageId),chinaName:s,currentUrl:pe((null===(i=null==t?void 0:t.rp)||void 0===i?void 0:i["request.URL"])||(null===(o=se())||void 0===o?void 0:o.href))}})),he=({userParams:e})=>{var t,n,i,o,r,a,s,l,d,c;const u=(null==e?void 0:e.clientID)||re("aer_fe_userid")||"",v=re("aer_auth_track_info")||void 0,p=re("aer_lang")||void 0,g=!!u,_=(null===(t=null==e?void 0:e.rp)||void 0===t?void 0:t["user.settings.region"])||void 0,h=(null===(n=null==e?void 0:e.rp)||void 0===n?void 0:n["user.settings.currency"])||void 0,f=(null===(i=null==e?void 0:e.rp)||void 0===i?void 0:i["user.settings.city"])||void 0,w=(null===(o=null==e?void 0:e.rp)||void 0===o?void 0:o["user.settings.province"])||void 0,m=(null===(r=null==e?void 0:e.rp)||void 0===r?void 0:r["user.settings.region"])||void 0,E=(null==e?void 0:e.aerAbTestIds)||"",y=Boolean((null===(a=null==e?void 0:e.rp)||void 0===a?void 0:a.isBot)||!1),I=Boolean(null===(s=null==e?void 0:e.rp)||void 0===s?void 0:s.abtest_override);return{clientId:u,encryptedData:v,lang:p,login:g,aerAbTest:"",region:_,currency:h,cityId:f,provinceId:w,country:m,clientIdChina:null===(c=null===(d=(null===(l=null==e?void 0:e.rp)||void 0===l?void 0:l["cookie:xman_us_t"])||re("xman_us_t"))||void 0===d?void 0:d.split("&").pop())||void 0===c?void 0:c.split("=").pop(),aerAbTestIds:E,isBot:y,abOverride:I}},fe=({userParams:e,trackerLogData:t})=>n(void 0,void 0,void 0,(function*(){const i=(({userParams:e,trackerLogData:t})=>Object.assign({},he({userParams:e,trackerLogData:t})))({userParams:e,trackerLogData:t}),o=(({userParams:e,trackerLogData:t})=>{const n=le({userParams:e,trackerLogData:t}),i=de({userParams:e,trackerLogData:t});return Object.assign(Object.assign({},n),i)})({userParams:e,trackerLogData:t}),r=yield(({userParams:e,trackerLogData:t})=>n(void 0,void 0,void 0,(function*(){const n=ge({userParams:e,trackerLogData:t}),i=yield _e({userParams:e,trackerLogData:t});return Object.assign(Object.assign({},n),i)})))({userParams:e,trackerLogData:t});oe.pageData={user:Object.assign({},i),page:Object.assign({},r),attributes:Object.assign({},o)},oe.isInitialized=!0})),we=({userParams:e,trackerLogData:t})=>{const n=le({userParams:e,trackerLogData:t}),i=(({trackerLogData:e})=>{if(!oe.isWebView)return{};const{attributes:t}=e;return{platform:null==t?void 0:t.platform,deviceId:null==t?void 0:t.deviceId,chinaDeviceId:null==t?void 0:t.chinaDeviceId,idfa:null==t?void 0:t.idfa,adId:null==t?void 0:t.adId,appVersion:null==t?void 0:t.appVersion,apiVersion:null==t?void 0:t.apiVersion}})({userParams:e,trackerLogData:t});return Object.assign(Object.assign({},n),i)},me=({userParams:e,trackerLogData:t})=>{const n=ge({userParams:e,trackerLogData:t}),i=(({trackerLogData:e})=>{if(!oe.isWebView)return{};const{page:t}=e,n=ve(),i=(null==t?void 0:t.name)||void 0,o=(null==t?void 0:t.pageId)||void 0,r=(null==t?void 0:t.pageViewId)||void 0,a=pe(null==t?void 0:t.currentUrl);return{pageId:n,previousName:i,previousPageId:o,previousPageViewId:r,previousChinaName:(null==t?void 0:t.chinaName)||void 0,referralUrl:a}})({userParams:e,trackerLogData:t});return Object.assign(Object.assign({},n),i)},Ee=({userParams:e,trackerLogData:t})=>Object.assign(Object.assign({},he({userParams:e,trackerLogData:t})),(({trackerLogData:e})=>{if(!oe.isWebView)return{};const{user:t}=e,n=(null==t?void 0:t.clientId)||"";return{clientId:n,login:!!n,encryptedData:null==t?void 0:t.encryptedData}})({userParams:e,trackerLogData:t})),ye=({userParams:e,trackerLogData:t})=>{try{oe.isGCP?fe({userParams:e,trackerLogData:t}):(({userParams:e,trackerLogData:t})=>{const n=Ee({userParams:e,trackerLogData:t}),i=we({userParams:e,trackerLogData:t}),o=me({userParams:e,trackerLogData:t});oe.pageData={user:Object.assign({},n),page:Object.assign({},o),attributes:Object.assign({},i)},oe.isInitialized=!0})({userParams:e,trackerLogData:t})}catch(e){oe.isInitialized=!0,console.error(e)}},Ie=()=>oe.pageData,Oe=e=>{const t=Ie();return(n,i,o,r)=>{var a;const s=((e,t)=>{var n,i;const o=null===(i=null===(n=Object.keys(t||{}))||void 0===n?void 0:n.map((e=>`${e}=${null==t?void 0:t[e]}`)))||void 0===i?void 0:i.join("&");return o?`${e}&${o}`:e})(o,{AerABID:(null===(a=t.attributes)||void 0===a?void 0:a.deviceId)||""});return e(n,i,s,r)}};const Ne=new class{constructor(){this.internalMessage=new Map,this.internalInitializedQueue=new Set}get message(){return this.internalMessage}get initializedQueue(){return this.internalInitializedQueue}getMessagesForRequest(){var e,t;const n=[...this.message.values()].slice(0,9),i=Array.from(n,(e=>(null==e?void 0:e.uuid)||""));for(const n of i)(null===(e=this.internalMessage)||void 0===e?void 0:e.has(n))&&(null===(t=this.internalMessage)||void 0===t||t.delete(n));return n}},Te=["accrual_loyalty","add_new_address","add_passport","add_recipient","added_photo_from_camera","added_photo_from_gallery","all","all_delivery_options","apply_promo_code","back_from_modal","buy_now","cancel","change","change_address","change_pickup_point","change_recipient","change_status","choose","close","close_address","close_captcha","close_choice_info","close_iin","close_mini_cart","close_modal","close_pd","close_select_sku","close_similar","close_threshold","come_back","confirm_changeПs","copy_link","create_new","decrement","delete","delete_address","edit_address","enter_phone_number","enter_promo_code","favorite","get_code","get_prize","go_to_cart","go_to_items","go_to_saved","hide","increment","input","make_a_photo","make_private","make_public","more_filters","more_products","move_to_cart","move_to_saved","msg_to_seller","msg_to_support","order_feedback","orders","outside_popup","pay","pay_now","photo_from_gallery","place_order","popup_remove","post_to_questions","product_complain","promo_code_input","redirect","remove","remove_all_filters","remove_all_mini_cart","remove_selected_available","remove_selected_unavailable","remove_unavailable","repeat_order","save","save_card","save_delivery","save_iin","save_pd","save_selected","select","select_address","select_custom_filter","select_filter","similar_items","switch_banner","switch_payment","switch_product_image","to_cart","to_cart_fail","unfavorite","unselect","unselect_custom_filter","unselect_filter","upload_again","use_loyalty","withdraw_loyalty","withhold_loyalty","apply_filters","get_auto_location","save_changes","get_coupon","close_description","confirm_point","get_stars","save_and_go_com","save_address","clearly","go_to_app","edit_international_address","switch_tab","reset_filters","rules_draw","to_tasks","watch_draw","view_on_map","view_total","like","unlike"],be=e=>{var t,n;if("undefined"!=typeof window)try{null===(n=null===(t=window.reasons)||void 0===t?void 0:t.sendReason)||void 0===n||n.call(t,e)}catch(e){console.error(e)}},Pe=(e,t,n)=>{var i;return null===(i=[...null==e?void 0:e.entries()])||void 0===i?void 0:i.map((([e,i])=>({code:"WEB_LOCAL_ANALYTICS",message:t,payload:{[n]:e,value:i,platform:oe.platform}})))};const Ae=new class{constructor(){this.internalFetchResult=new Map,this.internalFetchRetry=new Map}increaseFetchResult(e){const t=this.internalFetchResult.get(e)||0;this.internalFetchResult.set(e,t+1)}increaseFetchRetry(e){const t=this.internalFetchRetry.get(e)||0;this.internalFetchRetry.set(e,t+1)}sendCollectReasonMessages(){((e,t)=>{var n,i;try{"undefined"!=typeof window&&(null===(i=null===(n=window.reasons)||void 0===n?void 0:n.sendReasonList)||void 0===i||i.call(n,e,t))}catch(e){console.log(e)}})([...Pe(this.internalFetchResult,"FETCH_RESULT","status"),...Pe(this.internalFetchRetry,"FETCH_RETRY","group")],!0)}},Le=e=>{var t;if(e&&"undefined"!=typeof window){return new URLSearchParams(null===(t=null===window||void 0===window?void 0:window.location)||void 0===t?void 0:t.search).get(e)}return null},Se=e=>{try{return e?JSON.parse(e):null}catch(e){return null}},Ce={},Re=e=>{try{return!(!e||!Boolean(new URL(e)))}catch(e){return!1}},De=e=>e.map((e=>({uuid:e.uuid||"",timestamp:e.timestamp||"",actionType:e.actionType||""})));class ke{constructor(){this.retryCount=0,this.collectReason=e=>{"reject"===e&&(Ae.increaseFetchResult("retry"),this.retryCount+=1),"success"===e&&(Ae.increaseFetchRetry(((e=0)=>{switch(!0){case e>0&&e<=5:return"oneToFive";case e>5&&e<=10:return"sixToTen";case e>10:return"moreTen";default:return"none"}})(this.retryCount)),this.retryCount=0),Ae.increaseFetchResult(e)},this.retryFetch=({path:e,options:t,sendMessages:n})=>{const i=this.retryCount?((e,t)=>{const n=(null==e?void 0:e.map((e=>Object.assign(Object.assign({},e),{attributes:Object.assign(Object.assign({},e.attributes),{retryCount:t})}))))||[];return JSON.stringify({events:n})})(n,this.retryCount):(null==t?void 0:t.body)||"";((e="",t)=>{var n,i;return oe.isWebView||oe.isGCP?(null===window||void 0===window?void 0:window.originalFetch)?null===(n=null===window||void 0===window?void 0:window.originalFetch)||void 0===n?void 0:n.call(window,e,t):null===(i=window.fetch)||void 0===i?void 0:i.call(window,e,t):new Promise(((n,i)=>{var o,r;const a=new XMLHttpRequest;a.open("POST",e),(null==t?void 0:t.headers)instanceof Headers&&(null===(r=null===(o=t.headers)||void 0===o?void 0:o.forEach)||void 0===r||r.call(o,((e,t)=>{a.setRequestHeader(t,e)}))),a.onload=()=>{a.status>=200&&a.status<300?n(a.response):i(new Error(`Request failed with status: ${a.status}`))};try{a.onerror=()=>{i(new Error(ee))},oe.isWebView||(a.onabort=()=>{i(new Error(ee))},a.ontimeout=()=>{i(new Error(ee))})}catch(e){i(e)}a.send(null==t?void 0:t.body)}))})(e,Object.assign(Object.assign({},t),{body:i})).then((()=>{this.collectReason("success")})).catch((i=>{this.collectReason("reject"),be({code:"LOCAL_TRACKER",message:"Couldn't send analytics to local tracker",stack:i.stack,payload:Object.assign({},De(n))}),i.message===ee&&setTimeout((()=>this.retryFetch({path:e,options:t,sendMessages:n})),3e3)}))}}}var Ve="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},je="__lodash_hash_undefined__",Ue="[object Function]",xe="[object GeneratorFunction]",Me=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Be=/^\w*$/,We=/^\./,Fe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ge=/\\(\\)?/g,ze=/^\[object .+?Constructor\]$/,Ke=/^(?:0|[1-9]\d*)$/,Ye="object"==typeof Ve&&Ve&&Ve.Object===Object&&Ve,Je="object"==typeof self&&self&&self.Object===Object&&self,$e=Ye||Je||Function("return this")();var He,Xe=Array.prototype,Qe=Function.prototype,qe=Object.prototype,Ze=$e["__core-js_shared__"],et=(He=/[^.]+$/.exec(Ze&&Ze.keys&&Ze.keys.IE_PROTO||""))?"Symbol(src)_1."+He:"",tt=Qe.toString,nt=qe.hasOwnProperty,it=qe.toString,ot=RegExp("^"+tt.call(nt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),rt=$e.Symbol,at=Xe.splice,st=mt($e,"Map"),lt=mt(Object,"create"),dt=rt?rt.prototype:void 0,ct=dt?dt.toString:void 0;function ut(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function vt(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function pt(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function gt(e,t,n){var i=e[t];nt.call(e,t)&&Nt(i,n)&&(void 0!==n||t in e)||(e[t]=n)}function _t(e,t){for(var n=e.length;n--;)if(Nt(e[n][0],t))return n;return-1}function ht(e){return!(!bt(e)||(t=e,et&&et in t))&&(function(e){var t=bt(e)?it.call(e):"";return t==Ue||t==xe}(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(e)?ot:ze).test(function(e){if(null!=e){try{return tt.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(e));var t}function ft(e,t,n,i){if(!bt(e))return e;for(var o=-1,r=(t=function(e,t){if(Tt(e))return!1;var n=typeof e;if("number"==n||"symbol"==n||"boolean"==n||null==e||Pt(e))return!0;return Be.test(e)||!Me.test(e)||null!=t&&e in Object(t)}(t,e)?[t]:function(e){return Tt(e)?e:yt(e)}(t)).length,a=r-1,s=e;null!=s&&++o<r;){var l=It(t[o]),d=n;if(o!=a){var c=s[l];void 0===(d=i?i(c,l,s):void 0)&&(d=bt(c)?c:Et(t[o+1])?[]:{})}gt(s,l,d),s=s[l]}return e}function wt(e,t){var n,i,o=e.__data__;return("string"==(i=typeof(n=t))||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==n:null===n)?o["string"==typeof t?"string":"hash"]:o.map}function mt(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return ht(n)?n:void 0}function Et(e,t){return!!(t=null==t?9007199254740991:t)&&("number"==typeof e||Ke.test(e))&&e>-1&&e%1==0&&e<t}ut.prototype.clear=function(){this.__data__=lt?lt(null):{}},ut.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},ut.prototype.get=function(e){var t=this.__data__;if(lt){var n=t[e];return n===je?void 0:n}return nt.call(t,e)?t[e]:void 0},ut.prototype.has=function(e){var t=this.__data__;return lt?void 0!==t[e]:nt.call(t,e)},ut.prototype.set=function(e,t){return this.__data__[e]=lt&&void 0===t?je:t,this},vt.prototype.clear=function(){this.__data__=[]},vt.prototype.delete=function(e){var t=this.__data__,n=_t(t,e);return!(n<0)&&(n==t.length-1?t.pop():at.call(t,n,1),!0)},vt.prototype.get=function(e){var t=this.__data__,n=_t(t,e);return n<0?void 0:t[n][1]},vt.prototype.has=function(e){return _t(this.__data__,e)>-1},vt.prototype.set=function(e,t){var n=this.__data__,i=_t(n,e);return i<0?n.push([e,t]):n[i][1]=t,this},pt.prototype.clear=function(){this.__data__={hash:new ut,map:new(st||vt),string:new ut}},pt.prototype.delete=function(e){return wt(this,e).delete(e)},pt.prototype.get=function(e){return wt(this,e).get(e)},pt.prototype.has=function(e){return wt(this,e).has(e)},pt.prototype.set=function(e,t){return wt(this,e).set(e,t),this};var yt=Ot((function(e){var t;e=null==(t=e)?"":function(e){if("string"==typeof e)return e;if(Pt(e))return ct?ct.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(t);var n=[];return We.test(e)&&n.push(""),e.replace(Fe,(function(e,t,i,o){n.push(i?o.replace(Ge,"$1"):t||e)})),n}));function It(e){if("string"==typeof e||Pt(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function Ot(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var i=arguments,o=t?t.apply(this,i):i[0],r=n.cache;if(r.has(o))return r.get(o);var a=e.apply(this,i);return n.cache=r.set(o,a),a};return n.cache=new(Ot.Cache||pt),n}function Nt(e,t){return e===t||e!=e&&t!=t}Ot.Cache=pt;var Tt=Array.isArray;function bt(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function Pt(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==it.call(e)}var At=function(e,t,n){return null==e?e:ft(e,t,n)};const Lt=({sendByBeacon:e})=>{var t,n;if(!Ne.message.size||!oe.isInitialized)return;const i=new ke;let o=Ne.getMessagesForRequest();const r=null===(t=oe.pageData.attributes)||void 0===t?void 0:t.chinaDeviceId,a=null===(n=null===window||void 0===window?void 0:window.goldlog)||void 0===n?void 0:n.Etag;!r&&a&&(oe.pageData.attributes.chinaDeviceId=a,o=o.map((e=>Object.assign(Object.assign({},e),{attributes:Object.assign(Object.assign({},e.attributes),{chinaDeviceId:a})}))));const s=JSON.stringify({events:o}),l=`${Ce.handler}/v1/collect/aer`;try{!oe.isIosWv&&e&&"undefined"!=typeof navigator&&navigator.sendBeacon?navigator.sendBeacon(l,s):i.retryFetch({path:l,options:Object.assign({method:"POST",body:s,credentials:"omit",mode:"cors"},e&&{keepalive:!0}),sendMessages:o})}catch(e){be({code:"LOCAL_TRACKER",message:e.message,stack:e.stack,payload:Object.assign({},De(o))})}},St=(e,t,n)=>{var i,o,r,a,s;if(oe.isInitialized){const l=oe.excludeFieldsConfig,d=(new Date).toISOString(),c=ve(),u=e.actionType||"",v=null==u?void 0:u.includes("click"),p=Te.includes(u),g=Ie(),_=(({config:e,event:t})=>{e&&(null==t?void 0:t.actionType)&&(null==e?void 0:e[null==t?void 0:t.actionType])&&(null==e?void 0:e[t.actionType]).forEach((e=>{At(t,e,"")}));return Object.assign({},t)})({config:l,event:Object.assign(Object.assign(Object.assign({},e),g),{attributes:Object.assign(Object.assign({},null==g?void 0:g.attributes),{yandexClientAdvId:(null===(i=null==e?void 0:e.attributes)||void 0===i?void 0:i.yandexClientAdvId)||(null===(o=null==g?void 0:g.attributes)||void 0===o?void 0:o.yandexClientAdvId),chinaDeviceId:(null===(r=g.attributes)||void 0===r?void 0:r.chinaDeviceId)||(null===(a=null===window||void 0===window?void 0:window.goldlog)||void 0===a?void 0:a.Etag)||""}),page:Object.assign(Object.assign({},null==e?void 0:e.page),null==g?void 0:g.page),timestamp:d,uuid:c})});((e,t=!1)=>{try{const n=JSON.stringify(e||"");Re(oe.aerConsoleUrl)&&(!oe.isIosWv&&"undefined"!=typeof navigator&&navigator.sendBeacon?navigator.sendBeacon(oe.aerConsoleUrl,n):fetch(oe.aerConsoleUrl,Object.assign(Object.assign({method:"POST",mode:"cors"},t&&{keepalive:!0}),{body:n})).catch((()=>{})))}catch(e){}})(_,null==n?void 0:n.sendByBeacon),Ne.message.set((null==_?void 0:_.uuid)||"",_),(null===window||void 0===window?void 0:window.onAerTrackerEvent)&&window.onAerTrackerEvent(_),(v||p)&&(null===(s=null==e?void 0:e.trackingInfo)||void 0===s?void 0:s.spm)&&((e,t)=>{const n=localStorage.getItem(q),i=decodeURIComponent(n||"{}"),o=Se(i);o[e]=t;const r=Object.keys(o);if(r.length>100){const e=r.length-100;for(let t=0;t<e;t++)delete o[r[t]]}localStorage.setItem(q,encodeURIComponent(JSON.stringify(o)))})(e.trackingInfo.spm,c),(t||Ne.message.size>=9)&&Lt(Object.assign({},n))}else Ne.initializedQueue.add(e)},Ct=e=>e.productID||e.exp_product||e.x_object_id||e.prod||e.product_id,Rt=({parsedInfo:e,actionType:t,type:n,itemId:i})=>({actionType:t,trackingInfo:{spm:(null==e?void 0:e.spm)||(null==e?void 0:e["spm-cnt"])||"",spm_url:(null==e?void 0:e["spm-url"])||"",type:n,itemId:i,title:(null==e?void 0:e.title)||""}}),Dt=(()=>{const e=new Set;return n=>{var{itemId:i}=n,o=t(n,["itemId"]);i&&!e.has(i)&&(St(Rt(Object.assign(Object.assign({},o),{itemId:i}))),e.add(i))}})(),kt=e=>(t,n,i)=>{var o,r;const a=Object.assign({},n);e(t,n,i);try{const e=!(null===(o=null==a?void 0:a.gokey)||void 0===o?void 0:o.startsWith("msg=url="))||(null===(r=null==a?void 0:a.gokey)||void 0===r?void 0:r.startsWith("expdata="));if(a.gokey&&e){const e=(e=>{var t;return null===(t=null==e?void 0:e.split("&"))||void 0===t?void 0:t.reduce(((e,t)=>{const n=null==t?void 0:t.indexOf("="),[i,o]=[null==t?void 0:t.slice(0,n),null==t?void 0:t.slice(n+1)];return Object.assign(Object.assign({},e),{[i]:"expdata"===i?JSON.parse(o):o})}),{})})(a.gokey);if("CLK"===a.gmkey){const t=Ct(e),n=Object.fromEntries(new URLSearchParams(a.gokey).entries());if(Object.keys(n).length)if(n.clkdata||e.clkdata||!t){const t=`${e.clkdata}__${e.category_id}`,[n]=Se(t)||[],i=(e=>{var t,n;const i=Se((null===(t=null==e?void 0:e.exargs)||void 0===t?void 0:t["data-clk-s"])||{});return(null===(n=null==i?void 0:i.ae_object_value)||void 0===n?void 0:n.split("__")[1])||null})(n);i&&St(Rt({actionType:"click_product",itemId:i,parsedInfo:n,type:te}))}else St(Rt({actionType:"click_product",type:te,itemId:t,parsedInfo:e}))}if("EXP"===a.gmkey){const t=(e=>{var t;return Array.isArray(e.expdata)?(null===(t=e.expdata)||void 0===t?void 0:t.map((e=>{var t;return{itemId:Ct(Se(null===(t=null==e?void 0:e.exargs)||void 0===t?void 0:t["data-exp-s"]))||"",parsedInfo:e}})))||[]:[{itemId:Ct(e)||"",parsedInfo:e}]})(e);null==t||t.forEach((e=>{Dt(Object.assign({actionType:"view_product",type:te},e))}))}}}catch(e){console.error(e)}},Vt={record:e=>Oe(e),send:e=>kt(e)},jt=e=>{var t;(null===window||void 0===window?void 0:window.goldlog)&&(null===(t=window.goldlog)||void 0===t?void 0:t[e])?window.goldlog[e]=Vt[e](window.goldlog[e]):(window.goldlog={},Object.defineProperty(window.goldlog,e,{configurable:!0,get(){return this[`override_${e}`]},set(t){this[`override_${e}`]=Vt[e](t)}}))},Ut=()=>(null===localStorage||void 0===localStorage?void 0:localStorage.getItem(Q))||"",xt=e=>{try{const[t,n]=(null==e?void 0:e.split("&"))||[];return new URL(`${t}/event?consoleId=${n}`).toString()}catch(e){return"error"}},Mt=(e,t)=>{if("undefined"!=typeof window){const n=new StorageEvent("storage",{key:Q,oldValue:t,newValue:e});null===window||void 0===window||window.dispatchEvent(n)}},Bt=e=>{if(e){const t=Ut();null===localStorage||void 0===localStorage||localStorage.setItem(Q,e),Mt(e,t)}},Wt=e=>{St({actionType:"cookie_filing_yandex",attributes:{yandexClientAdvId:e},trackingInfo:{type:"cookie"}},!1,{})},Ft=e=>new Promise(((t,n)=>{if(e)try{null==e||e("29739640","getClientID",(e=>{t(e)}))}catch(e){console.error(e),n(e)}else n()})),Gt=e=>{var t,n;const i=!(!Le(X)||(null===document||void 0===document?void 0:document.referrer)),o={name:e.currentName||"",id:e.currentId||"",chinaName:e.currentChinaName||"",referralUrl:i?e.referralUrl:pe(null===(t=null===window||void 0===window?void 0:window.location)||void 0===t?void 0:t.href)},r={name:e.prevPageName||"",id:e.prevPageId||"",chinaName:e.prevChinaName||"",referralUrl:i?e.referralUrl:pe(null===(n=null===window||void 0===window?void 0:window.location)||void 0===n?void 0:n.href)};ae(H,encodeURIComponent(JSON.stringify(r))),ae($,encodeURIComponent(JSON.stringify(o)))},zt=(e=!1)=>{e||(Gt(oe.trackerLogData),St({trackingInfo:{type:ne},actionType:"page_close"},!0,{sendByBeacon:!0}),Ae.sendCollectReasonMessages())},Kt=()=>{const e=Ut();localStorage.removeItem(Q),Mt("",e)},Yt=()=>{try{if("undefined"!=typeof window&&(null===window||void 0===window?void 0:window.document)){if(!document.getElementById(Z)){const e=document.createElement("div");e.id=Z,e.style.cssText="position: fixed; top: 10px; right: 10px; z-index: 1000; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center;";const t=document.createElement("div");t.style.cssText="position: absolute; width: 100%; height: 100%; background: rgb(255, 255, 255); opacity: 0.65; z-index: -1;";const n=document.createElement("div");n.style.cssText='background: url("https://st.aliexpress.ru/mixer-storage/aerconsole/aerconsole.png") no-repeat; background-size: cover; width: 52px; height: 52px;';const i=document.createElement("span");i.style.cssText="text-align: center; font-size: 12px;",i.innerHTML="Выключить",e.appendChild(t),e.appendChild(n),e.appendChild(i),e.addEventListener("click",Kt),document.body.appendChild(e)}}}catch(e){}},Jt=()=>{setInterval((()=>{if(Lt({}),oe.isInitialized&&Ne.initializedQueue.size){for(const e of Ne.initializedQueue)St(e);Ne.initializedQueue.clear()}}),3e3),!oe.isWebView&&Re(oe.aerConsoleUrl)&&Yt()},$t=({key:e,newValue:t})=>{e===Q&&(t&&(oe.aerConsoleUrl=t||"empty"),Re(t)?Yt():((()=>{var e;try{if("undefined"!=typeof window&&(null===window||void 0===window?void 0:window.document)){const t=document.getElementById(Z);t&&(null===(e=t.remove)||void 0===e||e.call(t))}}catch(e){}})(),oe.aerConsoleUrl=""))};var Ht;!function(e){e.NAVIGATE="navigate",e.RELOAD="reload"}(Ht||(Ht={}));const Xt=e=>((e="{}")=>Se(decodeURIComponent(e)))(re(e)||"{}"),Qt=(e,t=!1)=>{let n=null,i=null;const o=function(){var e,t;let n=Ht.NAVIGATE;const i="undefined"!=typeof window,o=void 0!==window.performance;if(i&&o){const[i]=(null===(t=null===(e=null===window||void 0===window?void 0:window.performance)||void 0===e?void 0:e.getEntriesByType)||void 0===t?void 0:t.call(e,"navigation"))||[];n=(null==i?void 0:i.type)===Ht.RELOAD?Ht.RELOAD:Ht.NAVIGATE}return n}(),r=Le(X),a=(null===document||void 0===document?void 0:document.referrer)||r,s=t?ve():null==e?void 0:e.pageViewId;a&&(i=$),a&&o===Ht.RELOAD&&(i=H),i&&(n=Xt(i));return{currentId:s,currentName:null==e?void 0:e.alias,currentChinaName:null==e?void 0:e.smpB,prevPageId:null==n?void 0:n.id,prevPageName:null==n?void 0:n.name,prevChinaName:null==n?void 0:n.chinaName,referralUrl:null==n?void 0:n.referralUrl}};O();e.clearUrlAerConsole=Kt,e.getPageData=Ie,e.getPageDataServerPixel=e=>{var t,n,i,o;const r=(null===(t=null==e?void 0:e.rp)||void 0===t?void 0:t["cookie:cna"])||"";return{actionType:"server_pixel",page:{name:(null==e?void 0:e.alias)||"",chinaName:(null==e?void 0:e.smpB)||"",layoutId:(null===(n=null==e?void 0:e.layout)||void 0===n?void 0:n.id)||0,layoutName:(null===(i=null==e?void 0:e.layout)||void 0===i?void 0:i.name)||"",pageViewId:(null==e?void 0:e.pageViewId)||ve()},attributes:{chinaDeviceId:r,deviceId:e.abid||"",namespace:(null==e?void 0:e.namespace)||"external",platform:(null===(o=null==e?void 0:e.rp)||void 0===o?void 0:o.platform)||""}}},e.sendEvent=St,e.setUrlAerConsole=Bt,e.trackerInit=e=>n(void 0,void 0,void 0,(function*(){var n,i,o,r,a,s;const l=(null===(i=null===(n=null==e?void 0:e.rp)||void 0===n?void 0:n.useragent)||void 0===i?void 0:i.toLowerCase())||(null===(r=null===(o=null===window||void 0===window?void 0:window.navigator)||void 0===o?void 0:o.userAgent)||void 0===r?void 0:r.toLowerCase())||"";var d;d=(null==e?void 0:e.handler)||"",Ce.handler=d,oe.isWebView=l.endsWith("-wv"),oe.isIosWv=l.endsWith("-wv")&&l.includes("ios"),oe.platform=(null===(a=null==e?void 0:e.rp)||void 0===a?void 0:a.platform)||"",oe.isGCP=window.location.host.includes("promotion"),oe.excludeFieldsConfig=Se(null==e?void 0:e.excludeFieldsConfig),oe.trackerLogData=Qt(e,oe.isGCP),window.addEventListener("DOMContentLoaded",Jt),window.addEventListener("storage",$t),window.addEventListener("focus",(()=>Gt(oe.trackerLogData))),window.addEventListener("blur",(()=>Gt(oe.trackerLogData))),oe.isWebView?window.addEventListener("unload",(()=>zt(!!e.turnOffBaseEvents))):window.addEventListener("beforeunload",(()=>zt(!!e.turnOffBaseEvents))),Gt(oe.trackerLogData),oe.isGCP?jt("send"):jt("record");let c=oe.trackerLogData;if(oe.isWebView){const e=yield J.getAppLocalAnalyticsState({}),n=e.data||{},{consoleInfo:i=""}=n,o=t(n,["consoleInfo"]);oe.aerConsoleUrl=xt(i),e&&(c=Object.assign(Object.assign(Object.assign({},oe.trackerLogData),o),{page:(u=null==o?void 0:o.page,Object.assign(Object.assign({},u),{prevPageId:null==u?void 0:u.previousPageViewId,prevPageName:null==u?void 0:u.previousName,prevChinaName:null==u?void 0:u.previousChinaName,referralUrl:null==u?void 0:u.referralUrl}))}))}else{const e=(()=>{var e;try{if("undefined"!=typeof window){const t=new URLSearchParams(null===(e=null===window||void 0===window?void 0:window.location)||void 0===e?void 0:e.search),n=t.get("host"),i=t.get("consoleId");if(n&&i)return xt([n,i].join("&"))}return""}catch(e){return"error"}})(),t=Ut();e&&Bt(e),oe.aerConsoleUrl=e||t}var u;if(ye({userParams:e,trackerLogData:c}),J.saveTrackerData(Object.assign({actionType:ie},Ie())),(null===window||void 0===window?void 0:window.ym)?Ft(null===window||void 0===window?void 0:window.ym).then((e=>{Wt(e)})):Object.defineProperty(window,"ym",{configurable:!0,set(e){Object.defineProperty(window,"ym",{configurable:!0,value:e}),Ft(e).then((e=>{Wt(e)}))}}),!e.skipPageViewAnalytics&&!e.turnOffBaseEvents){(e=>{St({trackingInfo:{type:ne},actionType:ie,page:{clickId:e||""}})})(oe.isWebView?null===(s=c.page)||void 0===s?void 0:s.clickId:(()=>{var e,t,n;const i=localStorage.getItem(q),o=decodeURIComponent(i||"{}"),r=Se(o),a=Le("utm_medium"),s="sharing"===a||"cpa"===a,l=null===(n=null===(t=null===(e=Le(X))||void 0===e?void 0:e.split("."))||void 0===t?void 0:t.slice(0,4))||void 0===n?void 0:n.join(".");return l&&!s?null==r?void 0:r[l]:""})())}}))}));
//# sourceMappingURL=tracker.0.59.6.js.map